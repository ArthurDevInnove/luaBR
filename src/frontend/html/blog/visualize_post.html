<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Posts - LuaBR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="../static/moon-solid-24 (2).png"
      type="image/x-icon"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: #000;
      }
    </style>
  </head>
  <body>
    <header
      class="w-full bg-gray-900 text-white shadow-lg fixed top-0 left-0 z-50"
    >
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center gap-6">
            <i class="bx bx-moon text-2xl text-blue-500"></i>
            <span class="text-xl font-semibold">
              lua<span class="text-blue-500">BR</span>
            </span>

            <nav class="hidden md:flex items-center gap-6 ml-6">
              <a href="#" class="hover:text-blue-400 transition-colors"
                >P치gina Principal</a
              >
              <a href="#" class="hover:text-blue-400 transition-colors"
                >Relevantes</a
              >
            </nav>
          </div>

          <div class="flex items-center gap-4">
            <div class="relative">
              <input
                type="text"
                placeholder="Pesquisar"
                class="bg-gray-800 rounded-full py-2 px-4 w-48 focus:w-64 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
              />
            </div>

            <button
              class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-full transition-colors font-medium"
            >
              Cadastrar
            </button>
            <button
              class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-full transition-colors font-medium"
            >
              Registrar
            </button>
          </div>
        </div>
      </div>
    </header>

    <div
      id="errorCard"
      class="fixed top-20 right-5 max-w-xs p-4 bg-red-500 text-white rounded-lg opacity-0 shadow-lg transform translate-x-full transition duration-500 ease-in-out"
    >
      <p class="font-semibold">Erro!</p>
      <p id="errorMessage">An error occurred while processing your request.</p>
    </div>

    <main class="pt-28 pb-12 container mx-auto px-4 max-w-3xl">
      <!-- Cabe칞alho do Post -->
      <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-lg relative">
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-4">
            <div>
              <h2 class="font-semibold text-lg text-white" id="author">Jo칚o Silva</h2>
              <p class="text-gray-400 text-sm" id="time">Publicado h치</p>
            </div>
          </div>

          <div class="relative">
            <button id="postMenuButton" class="text-gray-400 hover:text-white p-2 rounded-lg hover:bg-gray-700">
              <i class="bx bx-dots-vertical-rounded text-xl"></i>
            </button>
            
            <div id="postMenu" class="hidden absolute right-0 mt-2 w-48 bg-gray-700 rounded-lg shadow-lg py-2 z-50">
              <button class="w-full px-4 py-2 text-left hover:bg-gray-600 text-white">
                <i class="bx bx-edit mr-2"></i>Editar Post
              </button>
              <button class="w-full px-4 py-2 text-left hover:bg-gray-600 text-white">
                <i class="bx bx-plus mr-2"></i>Criar Post
              </button>
            </div>
          </div>
        </div>

        <!-- Conte칰do Principal -->
        <h1 class="text-3xl font-bold mb-6 text-white" id="title">
          Comunica칞칚o entre Componentes no Angular: Guia Completo
        </h1>
        <div class="prose prose-invert max-w-none text-white">
          <p class="mb-4" id="content">
            Dominar a comunica칞칚o entre componentes 칠 essencial para construir
            aplica칞칫es Angular escal치veis. Vamos explorar:
          </p>
      </div>

      <!-- Se칞칚o de Coment치rios -->
      <div class="bg-gray-800 rounded-xl p-6 shadow-lg text-white">
        <h3 class="text-xl font-bold mb-6">游눫 15 Coment치rios</h3>

        <!-- Coment치rio 1 -->
        <div class="border-b border-gray-700 pb-6 mb-6">
          <div class="flex items-center gap-3 mb-4">
            <div>
              <h4 class="font-semibold">Carlos Ribeiro</h4>
              <p class="text-gray-400 text-sm">2 horas atr치s</p>
            </div>
          </div>
          <p class="text-gray-300">
            Excelente explica칞칚o! Como implementar isso com Signals no Angular
            17+?
          </p>
          <div class="flex gap-4 mt-4 text-gray-400">
            <button class="hover:text-blue-400 flex items-center gap-1">
              <i class="bx bx-like"></i> 12
            </button>
            <button class="hover:text-blue-400">Responder</button>
          </div>
        </div>

        <!-- Coment치rio 2 -->
        <div class="border-b border-gray-700 pb-6 mb-6">
          <div class="flex items-center gap-3 mb-4">
            <div>
              <h4 class="font-semibold">Ana Costa</h4>
              <p class="text-gray-400 text-sm">5 horas atr치s</p>
            </div>
          </div>
          <p class="text-gray-300">
            칍timo artigo! Faltou s칩 um exemplo de Mediator Pattern com Services.
          </p>
          <div class="flex gap-4 mt-4 text-gray-400">
            <button class="hover:text-blue-400 flex items-center gap-1">
              <i class="bx bx-like"></i> 8
            </button>
            <button class="hover:text-blue-400">Responder</button>
          </div>
        </div>

        <!-- Campo Novo Coment치rio -->
        <div class="pt-6">
          <textarea
            class="w-full bg-gray-700 rounded-lg p-4 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
            rows="4"
            placeholder="Adicione um coment치rio..."
          ></textarea>
          <button
            class="mt-4 bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-full transition-colors"
          >
            Publicar
          </button>
        </div>
      </div>
    </main>

    <footer class="bg-gray-900 text-white py-6">
      <div class="container mx-auto px-4 text-center">
        <p class="mb-2">&copy; 2025 LuaBR. Todos os direitos reservados.</p>
        <div class="flex justify-center space-x-4">
          <a href="#" class="hover:text-blue-400 transition-colors"
            >Termos de Servi칞o</a
          >
          <a href="#" class="hover:text-blue-400 transition-colors"
            >Pol칤tica de Privacidade</a
          >
          <a href="#" class="hover:text-blue-400 transition-colors">Contato</a>
        </div>
      </div>
    </footer>
  </body>
  <script>
    const id = localStorage.getItem('visualize_post');
    const url = `http://localhost:8000/posts/get/${id}`;
    let error_card = document.querySelector("#errorCard");
    let error_message = document.querySelector("#errorMessage");


    function getTimeSincePost(postDateTimeString) {
      const now = new Date();
      const postDate = new Date(postDateTimeString);

      if (postDate > now) {
        return { error: "Post date is in the future" };
      }

      const diffMs = now - postDate;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      const diffHours = Math.floor(
        (diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
      );
      const diffMinutes = Math.floor(
        (diffMs % (1000 * 60 * 60)) / (1000 * 60)
      );

      return { diffDays, diffHours, diffMinutes };
    }
  
    async function get_posts() {
      try {
        let response = await fetch(url, {
          method: "GET",
        });
  
        const result = await response.json();
        
        if (!response.ok) {
          throw new Error(result.detail || "Erro desconhecido!");
        }

        const {diffDays, diffHours, diffMinutes} = getTimeSincePost(
            result.post_hour
        )
  
        // Preenchendo apenas os elementos com IDs espec칤ficos
        document.querySelector("#author").textContent = result.author_name || "Autor desconhecido";
        document.querySelector("#time").textContent = `H치 ${diffDays} dias, ${diffHours} horas e ${diffMinutes} minutos. ` || "Data desconhecida";
        document.querySelector("#title").textContent = result.title || "T칤tulo n칚o dispon칤vel";
        document.querySelector("#content").textContent = result.content || "Conte칰do n칚o dispon칤vel";
      } catch (error) {
        console.error(error);
        error_message.textContent = error.message;
        error_card.classList.remove("opacity-0", "translate-x-full");
        error_card.classList.add("opacity-100", "translate-x-0");
  
        setTimeout(() => {
          error_card.classList.remove("opacity-100", "translate-x-0");
          error_card.classList.add("opacity-0", "translate-x-full");
        }, 3000);
      }
    }
  
    // Chama a fun칞칚o ao carregar a p치gina
    document.addEventListener("DOMContentLoaded", () => {
      get_posts()

      const postMenuButton = document.getElementById('postMenuButton');
      const postMenu = document.getElementById('postMenu');

      // Alternar menu
      postMenuButton.addEventListener('click', (e) => {
        e.stopPropagation();
        postMenu.classList.toggle('hidden');
      });

      // Fechar menu ao clicar fora
      document.addEventListener('click', () => {
        postMenu.classList.add('hidden');
      });

      // Prevenir fechamento ao clicar no menu
      postMenu.addEventListener('click', (e) => {
        e.stopPropagation();
      });
    });
  </script>
</html>
